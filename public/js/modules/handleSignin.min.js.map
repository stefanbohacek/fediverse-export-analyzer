{"version":3,"file":"handleSignin.min.js","sources":["modules/handleSignin.js"],"sourcesContent":["import getUrlParams from '/js/modules/getUrlParams.min.js';\r\nimport Cookie from '/js/cookies/main.min.js';\r\n\r\nconst cookieManager = new Cookie();\r\nconst signinForm = document.getElementById(\"signin-form\");\r\nconst instance = document.getElementById(\"instance\");\r\nconst signinButton = document.getElementById(\"signin-btn\");\r\n\r\nconst toggleFormElements = (form) => {\r\n  if (form.dataset.enabled === 'true'){\r\n    instance.disabled = true;\r\n    signinButton.disabled = true;\r\n    signinButton.innerHTML = 'Loading...';\r\n    form.dataset.enabled = 'false';\r\n  } else {\r\n    instance.disabled = false;\r\n    signinButton.disabled = false;\r\n    signinButton.innerHTML = 'Sign in';\r\n    form.dataset.enabled = 'true';\r\n  }\r\n};\r\n\r\nconst handleSignin = () => {\r\n  if (signinForm){\r\n    signinForm.addEventListener(\"submit\", async (ev) => {\r\n      ev.preventDefault();\r\n      toggleFormElements(signinForm);\r\n  \r\n      const resp = await fetch(`https://fediverse-info.stefanbohacek.dev/node-info?domain=${instance.value}`);\r\n      const respJSON = await resp.json();\r\n      if (respJSON && respJSON.software){\r\n        window.location.href = `https://auth.stefanbohacek.dev/?method=fediverse&instance=${instance.value}&scope=read:accounts&app=localhost-3000&platform=${respJSON.software}`;\r\n      } else {\r\n        alert(`This doesn't look like a fediverse instance.`);\r\n        toggleFormElements(signinForm);\r\n      }\r\n    });\r\n    \r\n    if (window.location.pathname === '/'){\r\n      const urlParams = getUrlParams();\r\n      const userCookie = cookieManager.get('fpusr');\r\n  \r\n      const startHerePopover = document.getElementById('popover-start');\r\n      if (startHerePopover){\r\n        startHerePopover.classList.add('show');\r\n      }\r\n  \r\n      if (!urlParams.logout && userCookie){\r\n        const {instance, platform, token} = JSON.parse(userCookie);\r\n        if (instance && platform && token){\r\n          window.location.href = `/?instance=${instance}&platform=${platform}&token=${token}`;\r\n        }\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nexport default handleSignin;\r\n"],"names":["getUrlParams","Cookie","cookieManager","signinForm","document","getElementById","instance","signinButton","toggleFormElements","form","dataset","enabled","disabled","innerHTML","handleSignin","addEventListener","async","ev","preventDefault","respJSON","await","fetch","value","json","software","window","location","href","alert","pathname","urlParams","userCookie","get","startHerePopover","classList","add","logout","platform","token","JSON","parse"],"mappings":"OAAOA,iBAAkB,yCAClBC,WAAY,0BAEnB,MAAMC,cAAgB,IAAID,OACpBE,WAAaC,SAASC,eAAe,aAAa,EAClDC,SAAWF,SAASC,eAAe,UAAU,EAC7CE,aAAeH,SAASC,eAAe,YAAY,EAEnDG,mBAAqB,IACI,SAAzBC,EAAKC,QAAQC,SACfL,SAASM,SAAW,CAAA,EACpBL,aAAaK,SAAW,CAAA,EACxBL,aAAaM,UAAY,aACzBJ,EAAKC,QAAQC,QAAU,UAEvBL,SAASM,SAAW,CAAA,EACpBL,aAAaK,SAAW,CAAA,EACxBL,aAAaM,UAAY,UACzBJ,EAAKC,QAAQC,QAAU,OAE3B,EAEMG,aAAe,KACnB,GAAIX,aACFA,WAAWY,iBAAiB,SAAUC,MAAOC,IAC3CA,EAAGC,eAAe,EAClBV,mBAAmBL,UAAU,EAGvBgB,EAAWC,MADJA,MAAMC,MAAM,6DAA6Df,SAASgB,KAAO,GAC1EC,KAAK,EAC7BJ,GAAYA,EAASK,SACvBC,OAAOC,SAASC,kEAAoErB,SAASgB,yDAAyDH,EAASK,UAE/JI,MAAM,8CAA8C,EACpDpB,mBAAmBL,UAAU,EAEjC,CAAC,EAEgC,MAA7BsB,OAAOC,SAASG,UAAiB,CACnC,IAAMC,EAAY9B,aAAa,EACzB+B,EAAa7B,cAAc8B,IAAI,OAAO,EAEtCC,EAAmB7B,SAASC,eAAe,eAAe,EAKhE,GAJI4B,GACFA,EAAiBC,UAAUC,IAAI,MAAM,EAGnC,CAACL,EAAUM,QAAUL,EAAW,CAClC,KAAM,CAACzB,SAAU+B,SAAAA,EAAUC,MAAAA,CAAK,EAAIC,KAAKC,MAAMT,CAAU,EACrDzB,UAAY+B,GAAYC,IAC1Bb,OAAOC,SAASC,mBAAqBrB,qBAAqB+B,WAAkBC,EAEhF,CACF,CAEJ,iBAEexB"}